<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Manager Dashboard - Fleet Management System</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">
  <link rel="stylesheet" href="/static/modern_theme.css">
  <link rel="stylesheet" href="/static/help_system.css">
  <link rel="stylesheet" href="/static/enhanced_help_system.css">
  <link rel="stylesheet" href="/static/autocomplete.css">
  <style nonce="{{.CSPNonce}}">
    /* Beautiful gradient background like login page */
    body {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
    }
    
    /* Main content wrapper with glass effect */
    .page-wrapper {
      min-height: 100vh;
      background: rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(10px);
    }
    
    .main-content {
      padding: 2rem;
      max-width: 1400px;
      margin: 0 auto;
    }
    
    /* Navigation override for purple theme */
    .navbar {
      background: rgba(255, 255, 255, 0.95) !important;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
      border-bottom: 1px solid rgba(255, 255, 255, 0.2);
    }
    
    .navbar-brand, .navbar-nav .nav-link {
      color: #667eea !important;
    }
    
    /* Enhanced card styling */
    .card {
      background: rgba(255, 255, 255, 0.95);
      border: 1px solid rgba(255, 255, 255, 0.3);
      box-shadow: 0 8px 32px rgba(31, 38, 135, 0.15);
      backdrop-filter: blur(4px);
    }
    
    /* Colorful metric cards with different gradients */
    .metric-card {
      background: rgba(255, 255, 255, 0.95);
      position: relative;
      overflow: hidden;
    }
    
    .metric-card:nth-child(1) .metric-icon {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }
    
    .metric-card:nth-child(2) .metric-icon {
      background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }
    
    .metric-card:nth-child(3) .metric-icon {
      background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }
    
    .metric-card:nth-child(4) .metric-icon {
      background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }
    
    .metric-card:nth-child(1)::before {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    }
    
    .metric-card:nth-child(2)::before {
      background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
    }
    
    .metric-card:nth-child(3)::before {
      background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
    }
    
    .metric-card:nth-child(4)::before {
      background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
    }
    
    /* Section headings with white text on purple background */
    .section-heading {
      color: white !important;
      text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
    }
    
    .section-heading i {
      color: white !important;
    }
    
    /* Quick actions grid for dashboard */
    .quick-actions {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: 1.5rem;
      margin-bottom: 2.5rem;
    }
    
    /* Quick action cards with beautiful gradients */
    .quick-action {
      display: flex;
      flex-direction: column;
      align-items: center;
      text-align: center;
      padding: 2rem 1.5rem;
      background: white;
      border: none;
      border-radius: 20px;
      text-decoration: none;
      color: white;
      transition: all 0.3s ease;
      min-height: 160px;
      position: relative;
      overflow: hidden;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
    }
    
    /* Different gradient backgrounds for each quick action */
    .quick-action:nth-child(1) {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    }
    
    .quick-action:nth-child(2) {
      background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
    }
    
    .quick-action:nth-child(3) {
      background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
    }
    
    .quick-action:nth-child(4) {
      background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
    }
    
    .quick-action:nth-child(5) {
      background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
    }
    
    .quick-action:nth-child(6) {
      background: linear-gradient(135deg, #30cfd0 0%, #330867 100%);
    }
    
    .quick-action:nth-child(7) {
      background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);
    }
    
    .quick-action:nth-child(8) {
      background: linear-gradient(135deg, #ff9a9e 0%, #fecfef 100%);
    }
    
    .quick-action:nth-child(9) {
      background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%);
    }
    
    /* Shimmer effect on hover */
    .quick-action::before {
      content: '';
      position: absolute;
      top: -50%;
      left: -50%;
      width: 200%;
      height: 200%;
      background: linear-gradient(45deg, transparent 30%, rgba(255,255,255,0.3) 50%, transparent 70%);
      transform: rotate(45deg) translateX(-100%);
      transition: transform 0.6s;
    }
    
    .quick-action:hover::before {
      transform: rotate(45deg) translateX(100%);
    }
    
    .quick-action:hover {
      transform: translateY(-8px) scale(1.02);
      box-shadow: 0 15px 40px rgba(0, 0, 0, 0.3);
    }
    
    .quick-action i {
      font-size: 3rem;
      margin-bottom: 1rem;
      color: white;
      filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.2));
      transition: all 0.3s ease;
      z-index: 1;
      position: relative;
    }
    
    .quick-action:hover i {
      transform: scale(1.2) rotate(5deg);
    }
    
    .quick-action span {
      font-weight: 600;
      font-size: 1.15rem;
      color: white;
      text-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
      z-index: 1;
      position: relative;
    }
    
    /* Data grid for metrics */
    .data-grid-primary {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 1.5rem;
      margin-bottom: 2rem;
    }
    
    /* Activity list */
    .activity-list {
      list-style: none;
      padding: 0;
      margin: 0;
    }
    
    .activity-item {
      display: flex;
      align-items: center;
      padding: 1rem;
      border-bottom: 1px solid #e9ecef;
      transition: background var(--transition-fast);
    }
    
    .activity-item:hover {
      background: #f8f9fa;
    }
    
    .activity-item:last-child {
      border-bottom: none;
    }
    
    .activity-item i {
      font-size: 1.25rem;
      margin-right: 1rem;
      flex-shrink: 0;
    }
    
    .activity-time {
      margin-left: auto;
      color: var(--color-text-secondary);
      font-size: 0.9rem;
      white-space: nowrap;
    }
    
    /* Alert header */
    .alert-header {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      margin-bottom: 0.5rem;
      font-weight: 600;
    }
    
    /* Beautiful alert styling */
    .alert-warning {
      background: linear-gradient(135deg, #fff3cd 0%, #ffe8a1 100%);
      border: none;
      color: #664d03;
      box-shadow: 0 4px 15px rgba(255, 193, 7, 0.2);
    }
    
    /* Enhanced form controls */
    .form-control {
      background: rgba(255, 255, 255, 0.9);
      border: 2px solid rgba(255, 255, 255, 0.3);
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
    }
    
    .form-control:focus {
      background: white;
      border-color: #667eea;
      box-shadow: 0 0 0 0.25rem rgba(102, 126, 234, 0.25);
    }
    
    /* Beautiful section backgrounds */
    .content-section {
      background: rgba(255, 255, 255, 0.05);
      border-radius: 20px;
      padding: 1.5rem;
      margin-bottom: 2rem;
      backdrop-filter: blur(5px);
    }
    
    /* Text colors for visibility */
    .text-success { color: #10b981 !important; }
    .text-info { color: #3b82f6 !important; }
    .text-warning { color: #f59e0b !important; }
    
    /* Animations with staggered delays */
    @keyframes fadeInUp {
      from {
        opacity: 0;
        transform: translateY(30px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    
    @keyframes pulse {
      0%, 100% {
        transform: scale(1);
      }
      50% {
        transform: scale(1.05);
      }
    }
    
    .metric-card {
      animation: fadeInUp 0.5s ease-out;
      animation-fill-mode: both;
    }
    
    .metric-card:nth-child(1) { animation-delay: 0.1s; }
    .metric-card:nth-child(2) { animation-delay: 0.2s; }
    .metric-card:nth-child(3) { animation-delay: 0.3s; }
    .metric-card:nth-child(4) { animation-delay: 0.4s; }
    
    .quick-action {
      animation: fadeInUp 0.6s ease-out;
      animation-fill-mode: both;
    }
    
    .quick-action:nth-child(1) { animation-delay: 0.1s; }
    .quick-action:nth-child(2) { animation-delay: 0.15s; }
    .quick-action:nth-child(3) { animation-delay: 0.2s; }
    .quick-action:nth-child(4) { animation-delay: 0.25s; }
    .quick-action:nth-child(5) { animation-delay: 0.3s; }
    .quick-action:nth-child(6) { animation-delay: 0.35s; }
    .quick-action:nth-child(7) { animation-delay: 0.4s; }
    .quick-action:nth-child(8) { animation-delay: 0.45s; }
    .quick-action:nth-child(9) { animation-delay: 0.5s; }
    
    /* Floating animation for metrics */
    .metric-card:hover {
      animation: pulse 2s infinite;
    }
    
    /* Responsive adjustments */
    @media (max-width: 768px) {
      .quick-actions {
        grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
        gap: 1rem;
      }
      
      .quick-action {
        padding: 1.5rem 1rem;
        min-height: 130px;
      }
      
      .quick-action i {
        font-size: 2.5rem;
      }
      
      .quick-action span {
        font-size: 1rem;
      }
    }
  </style>
</head>
<body>
  <div class="page-wrapper">
    <!-- Navigation Component -->
    {{$pageDesc := printf "Welcome back, %s" .User.Username}}
    {{template "navigation" (dict "Navigation" .Navigation "CSPNonce" .CSPNonce "ShowHelpButton" .ShowHelpButton "PageDescription" $pageDesc)}}
    
    <!-- Main Content -->
    <main id="main-content" class="main-content">
      <!-- Quick Search Bar -->
      <section class="content-section" aria-labelledby="search-heading">
        <h2 id="search-heading" class="section-heading sr-only">Quick Search</h2>
        <div class="card">
          <div class="card-body">
            <div class="row">
              <div class="col-md-6 mb-3">
                <label for="quickSearchBus" class="form-label">Search Bus</label>
                <input type="text" id="quickSearchBus" class="form-control" 
                       placeholder="Type bus ID or model...">
              </div>
              <div class="col-md-6 mb-3">
                <label for="quickSearchDriver" class="form-label">Search Driver</label>
                <input type="text" id="quickSearchDriver" class="form-control" 
                       placeholder="Type driver name...">
              </div>
            </div>
          </div>
        </div>
      </section>
      
      <!-- Dashboard Shortcuts -->
      {{template "dashboard-shortcuts" (dict "UserRole" .User.Role "CSPNonce" .CSPNonce)}}
      
      <!-- Metrics Cards -->
      <section class="content-section" aria-labelledby="metrics-heading">
        <h2 id="metrics-heading" class="section-heading">
          <i class="bi bi-speedometer2" aria-hidden="true"></i>
          Fleet Overview
        </h2>
        <div class="data-grid-primary">
          <!-- Total Buses -->
          <div class="metric-card">
            <div class="text-center">
              <i class="bi bi-bus-front-fill metric-icon" style="color: #667eea;" aria-hidden="true"></i>
              <div class="metric-value">{{.TotalBuses}}</div>
              <div class="metric-label">Total Buses</div>
            </div>
          </div>
          
          <!-- Active Drivers -->
          <div class="metric-card">
            <div class="text-center">
              <i class="bi bi-people-fill metric-icon" style="color: #11998e;" aria-hidden="true"></i>
              <div class="metric-value">{{.TotalDrivers}}</div>
              <div class="metric-label">Active Drivers</div>
            </div>
          </div>
          
          <!-- Total Students -->
          <div class="metric-card">
            <div class="text-center">
              <i class="bi bi-person-badge-fill metric-icon" style="color: #4facfe;" aria-hidden="true"></i>
              <div class="metric-value">{{.TotalStudents}}</div>
              <div class="metric-label">Total Students</div>
            </div>
          </div>
          
          <!-- Active Routes -->
          <div class="metric-card">
            <div class="text-center">
              <i class="bi bi-map-fill metric-icon" style="color: #fa709a;" aria-hidden="true"></i>
              <div class="metric-value">{{.ActiveRoutes}}</div>
              <div class="metric-label">Active Routes</div>
            </div>
          </div>
        </div>
      </section>
      
      <!-- Quick Actions -->
      <section class="content-section" aria-labelledby="actions-heading">
        <h2 id="actions-heading" class="section-heading">
          <i class="bi bi-lightning-charge-fill" aria-hidden="true"></i>
          Quick Actions
        </h2>
        <div class="quick-actions" data-help="quick-actions">
          <a href="/fleet" class="quick-action" data-help="manage-fleet" data-help-title="Manage Fleet" data-help-content="View and manage all buses and vehicles in your fleet. Check maintenance status, update vehicle information, and track availability.">
            <i class="bi bi-bus-front" aria-hidden="true"></i>
            <span>Manage Fleet</span>
          </a>
          
          <a href="/assign-routes" class="quick-action" data-help="assign-routes" data-help-title="Assign Routes" data-help-content="Assign drivers to specific bus routes. Ensure each route has a driver and vehicle assigned before the start of each day.">
            <i class="bi bi-diagram-3" aria-hidden="true"></i>
            <span>Assign Routes</span>
          </a>
          
          <a href="/students" class="quick-action" data-help="manage-students" data-help-title="Manage Students" data-help-content="Add, edit, or remove students from the system. Manage student information, routes, and pickup/dropoff schedules.">
            <i class="bi bi-people" aria-hidden="true"></i>
            <span>Manage Students</span>
          </a>
          
          <a href="/ecse-dashboard" class="quick-action" data-help="ecse-dashboard" data-help-title="ECSE Dashboard" data-help-content="View and manage Early Childhood Special Education students. Monitor transportation requirements and IEP statuses.">
            <i class="bi bi-mortarboard-fill" aria-hidden="true"></i>
            <span>ECSE Students</span>
          </a>
          
          <a href="/import-ecse" class="quick-action" data-help="import-ecse" data-help-title="Import ECSE Data" data-help-content="Import Early Childhood Special Education student data from Excel files. This helps manage special needs transportation requirements.">
            <i class="bi bi-file-earmark-excel" aria-hidden="true"></i>
            <span>Import ECSE</span>
          </a>
          
          <a href="/import-data-wizard" class="quick-action" data-help="import-wizard" data-help-title="Import Data Wizard" data-help-content="Use the step-by-step wizard to import any type of data with automatic column mapping and validation.">
            <i class="bi bi-cloud-upload" aria-hidden="true"></i>
            <span>Import Wizard</span>
          </a>
          
          <a href="/monthly-mileage-reports" class="quick-action" data-help="monthly-mileage" data-help-title="Monthly Mileage" data-help-content="View monthly mileage reports for all buses. Track total miles driven, fuel consumption, and identify high-usage vehicles.">
            <i class="bi bi-speedometer2" aria-hidden="true"></i>
            <span>Monthly Mileage</span>
          </a>
          
          <a href="/view-mileage-reports" class="quick-action" data-help="view-reports" data-help-title="View Reports" data-help-content="Access various reports including mileage, maintenance history, and driver performance. Export reports for record keeping.">
            <i class="bi bi-graph-up" aria-hidden="true"></i>
            <span>View Reports</span>
          </a>
          
          <a href="/approve-users" class="quick-action" data-help="approve-users" data-help-title="Approve Users" data-help-content="Review and approve new driver registrations. New users cannot access the system until approved by a manager.">
            <i class="bi bi-person-check" aria-hidden="true"></i>
            <span>Approve Users</span>
          </a>
        </div>
      </section>
      
      <!-- Maintenance Alerts -->
      {{if .MaintenanceAlerts}}
      <section aria-labelledby="alerts-heading">
        <h2 id="alerts-heading">Maintenance Alerts</h2>
        <div class="card">
          <div class="card-body">
            {{range .MaintenanceAlerts}}
            <div class="alert alert-warning" role="alert">
              <div class="alert-header">
                <i class="bi bi-exclamation-triangle-fill" aria-hidden="true"></i>
                <strong>Maintenance Required</strong>
              </div>
              <p>Bus {{.BusID}} - {{.Message}}</p>
            </div>
            {{end}}
          </div>
        </div>
      </section>
      {{end}}
      
      <!-- Recent Activity -->
      <section aria-labelledby="activity-heading">
        <h2 id="activity-heading">Recent Activity</h2>
        <div class="card">
          <div class="card-body">
            <ul class="activity-list">
              <li class="activity-item">
                <i class="bi bi-check-circle text-success" aria-hidden="true"></i>
                <span>All morning routes completed successfully</span>
                <time class="activity-time">2 hours ago</time>
              </li>
              <li class="activity-item">
                <i class="bi bi-person-plus text-info" aria-hidden="true"></i>
                <span>New driver registration pending approval</span>
                <time class="activity-time">3 hours ago</time>
              </li>
              <li class="activity-item">
                <i class="bi bi-tools text-warning" aria-hidden="true"></i>
                <span>Bus 105 scheduled for maintenance</span>
                <time class="activity-time">Yesterday</time>
              </li>
            </ul>
          </div>
        </div>
      </section>
    </main>
  </div>
  
  <script src="/static/help_system.js"></script>
  <script src="/static/enhanced_help_system.js"></script>
  <script src="/static/autocomplete.js"></script>
  
  {{template "error_prevention_scripts" .}}
  <script nonce="{{.CSPNonce}}">
    // Add help content for quick actions
    document.addEventListener('DOMContentLoaded', function() {
      if (window.helpSystem) {
        window.helpSystem.addHelpContent('quick-actions', {
          title: 'Quick Actions',
          content: 'These buttons provide quick access to common management tasks. Click any action to navigate to that section.'
        });
      }
      
      // Initialize auto-complete for quick search
      initializeQuickSearch();
    });
    
    function initializeQuickSearch() {
      // Bus search auto-complete
      const busSearch = new AutoComplete('quickSearchBus', {
        source: '/api/search-buses',
        minChars: 1,
        template: function(item) {
          return `
            <div class="autocomplete-item-custom">
              <i class="bi ${item.icon || 'bi-bus-front'} autocomplete-item-icon"></i>
              <div class="autocomplete-item-content">
                <div class="autocomplete-item-title">${item.label}</div>
                <div class="autocomplete-item-subtitle">${item.subtitle}</div>
              </div>
            </div>
          `;
        },
        onSelect: function(item) {
          // Navigate to bus details
          window.location.href = `/bus-maintenance/${item.value}`;
        }
      });
      
      // Driver search auto-complete
      const driverSearch = new AutoComplete('quickSearchDriver', {
        source: '/api/search-drivers',
        minChars: 2,
        template: function(item) {
          return `
            <div class="autocomplete-item-custom">
              <i class="bi ${item.icon || 'bi-person-circle'} autocomplete-item-icon"></i>
              <div class="autocomplete-item-content">
                <div class="autocomplete-item-title">${item.label}</div>
                <div class="autocomplete-item-subtitle">${item.subtitle}</div>
              </div>
            </div>
          `;
        },
        onSelect: function(item) {
          // Navigate to driver profile
          window.location.href = `/driver/${item.value}`;
        }
      });
    }
  </script>
</body>
</html>