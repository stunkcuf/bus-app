<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Student Management - Fleet Management System</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">
  <!-- Touch-Friendly Controls -->
  <link rel="stylesheet" href="/static/touch_friendly.css">
  
  <style nonce="{{.CSPNonce}}">
    /* Enhanced glass morphism design system */
    :root {
      --gradient-1: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      --gradient-2: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
      --gradient-3: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
      --gradient-4: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
      --gradient-5: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
      --gradient-6: linear-gradient(135deg, #30cfd0 0%, #330867 100%);
      --gradient-7: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);
      --gradient-8: linear-gradient(135deg, #ff9a9e 0%, #fecfef 100%);
      --gradient-dark: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
      
      /* Glass morphism variables */
      --glass-bg: rgba(255, 255, 255, 0.1);
      --glass-border: rgba(255, 255, 255, 0.2);
      --glass-shadow: 0 8px 32px rgba(0, 0, 0, 0.37);
      --glass-blur: 20px;
    }
    
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      background: #1a1a2e;
      background: linear-gradient(135deg, #16213e 0%, #0f3460 50%, #533483 100%);
      min-height: 100vh;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
      overflow-x: hidden;
      position: relative;
      color: white;
      padding-top: 70px;
    }
    
    /* Enhanced animated background */
    body::before {
      content: '';
      position: fixed;
      top: -50%;
      right: -30%;
      width: 100%;
      height: 100%;
      background: radial-gradient(circle, rgba(147, 51, 234, 0.3) 0%, transparent 70%);
      filter: blur(100px);
      z-index: -1;
      animation: floatBackground 20s ease-in-out infinite;
    }
    
    body::after {
      content: '';
      position: fixed;
      bottom: -50%;
      left: -30%;
      width: 100%;
      height: 100%;
      background: radial-gradient(circle, rgba(59, 130, 246, 0.3) 0%, transparent 70%);
      filter: blur(100px);
      z-index: -1;
      animation: floatBackground 20s ease-in-out infinite reverse;
    }
    
    @keyframes floatBackground {
      0%, 100% { transform: translate(0, 0) scale(1); }
      33% { transform: translate(30px, -30px) scale(1.1); }
      66% { transform: translate(-20px, 20px) scale(0.9); }
    }
    
    /* Enhanced navigation */
    .navbar-glass {
      background: var(--glass-bg);
      backdrop-filter: blur(var(--glass-blur));
      -webkit-backdrop-filter: blur(var(--glass-blur));
      border-bottom: 1px solid var(--glass-border);
      padding: 0.75rem 0;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      z-index: 1000;
      box-shadow: var(--glass-shadow);
      transition: all 0.3s ease;
    }
    
    .navbar-glass:hover {
      background: rgba(255, 255, 255, 0.12);
    }
    
    .navbar-brand {
      color: white;
      font-weight: 700;
      font-size: 1.5rem;
      display: flex;
      align-items: center;
      gap: 0.75rem;
      text-decoration: none;
      transition: all 0.3s ease;
    }
    
    .navbar-brand:hover {
      transform: translateY(-2px);
      text-shadow: 0 5px 15px rgba(255, 255, 255, 0.3);
    }
    
    /* Enhanced glass cards */
    .glass-card {
      background: var(--glass-bg);
      backdrop-filter: blur(var(--glass-blur));
      -webkit-backdrop-filter: blur(var(--glass-blur));
      border-radius: 24px;
      border: 1px solid var(--glass-border);
      padding: 2.5rem;
      margin-bottom: 2rem;
      box-shadow: var(--glass-shadow);
      color: white;
      position: relative;
      overflow: hidden;
      transition: all 0.3s ease;
    }
    
    .glass-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(135deg, rgba(255, 255, 255, 0.1) 0%, transparent 60%);
      pointer-events: none;
    }
    
    .glass-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 12px 40px rgba(0, 0, 0, 0.4);
    }
    
    /* Enhanced form styling */
    .form-control,
    .form-select {
      background: rgba(255, 255, 255, 0.08);
      border: 1px solid rgba(255, 255, 255, 0.2);
      border-radius: 12px;
      color: white;
      padding: 0.875rem 1.25rem;
      transition: all 0.3s ease;
      font-size: 0.95rem;
    }
    
    .form-control:focus,
    .form-select:focus {
      background: rgba(255, 255, 255, 0.12);
      border-color: rgba(102, 126, 234, 0.5);
      box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.1);
      color: white;
      outline: none;
    }
    
    .form-control::placeholder {
      color: rgba(255, 255, 255, 0.5);
    }
    
    .form-select option {
      background: #1a1a2e;
      color: white;
    }
    
    /* Fix Bootstrap dropdown colors */
    .form-select {
      background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16'%3e%3cpath fill='none' stroke='%23ffffff' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M2 5l6 6 6-6'/%3e%3c/svg%3e");
    }
    
    /* Button styling */
    .btn {
      padding: 0.75rem 1.5rem;
      border-radius: 25px;
      font-weight: 600;
      transition: all 0.3s ease;
      border: none;
      text-decoration: none;
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
    }
    
    .btn-primary {
      background: var(--gradient-1);
      color: white;
      box-shadow: 0 5px 20px rgba(102, 126, 234, 0.5);
    }
    
    .btn-primary:hover {
      transform: translateY(-3px);
      box-shadow: 0 10px 40px rgba(102, 126, 234, 0.7);
    }
    
    .btn-outline-primary {
      background: transparent;
      border: 1px solid rgba(102, 126, 234, 0.5);
      color: #a8b9ff;
    }
    
    .btn-outline-primary:hover {
      background: rgba(102, 126, 234, 0.1);
      border-color: #667eea;
      color: #c8d4ff;
    }
    
    .btn-outline-danger {
      background: transparent;
      border: 1px solid rgba(239, 68, 68, 0.5);
      color: #ff9999;
    }
    
    .btn-outline-danger:hover {
      background: rgba(239, 68, 68, 0.1);
      border-color: #ef4444;
      color: #ffb3b3;
    }
    
    .btn-secondary {
      background: rgba(255, 255, 255, 0.1);
      border: 1px solid rgba(255, 255, 255, 0.2);
      color: white;
    }
    
    .btn-secondary:hover {
      background: rgba(255, 255, 255, 0.15);
      border-color: rgba(255, 255, 255, 0.3);
      color: white;
    }
    
    /* Ensure badge text is visible */
    .badge {
      color: white;
    }
    
    /* Small buttons */
    .btn-sm {
      padding: 0.5rem 1rem;
      font-size: 0.875rem;
    }
    
    /* Enhanced metrics grid */
    .metrics-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 1.5rem;
      margin-bottom: 2rem;
    }
    
    .metric-card {
      position: relative;
      background: var(--glass-bg);
      backdrop-filter: blur(var(--glass-blur));
      -webkit-backdrop-filter: blur(var(--glass-blur));
      border-radius: 16px;
      padding: 1rem;
      text-align: center;
      color: white;
      border: 1px solid var(--glass-border);
      overflow: hidden;
      transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    }
    
    .metric-card::before {
      content: '';
      position: absolute;
      top: -2px;
      left: -2px;
      right: -2px;
      bottom: -2px;
      background: var(--gradient-1);
      border-radius: 16px;
      opacity: 0;
      z-index: -1;
      transition: opacity 0.3s ease;
    }
    
    .metric-card:hover {
      transform: translateY(-5px) scale(1.02);
      box-shadow: 0 15px 30px rgba(0, 0, 0, 0.3);
    }
    
    .metric-card:hover::before {
      opacity: 0.3;
    }
    
    .metric-icon {
      font-size: 1.25rem;
      margin-bottom: 0.5rem;
      background: var(--gradient-1);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }
    
    .metric-value {
      font-size: 1.25rem;
      font-weight: 700;
      margin-bottom: 0.25rem;
      letter-spacing: -0.5px;
    }
    
    .metric-label {
      font-size: 0.75rem;
      opacity: 0.8;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      color: white;
    }
    
    /* Hero section */
    .hero-section {
      position: relative;
      padding: 2rem 0;
      text-align: center;
      color: white;
      overflow: hidden;
      background: linear-gradient(135deg, rgba(102, 126, 234, 0.1) 0%, transparent 100%);
      border-radius: 0 0 50px 50px;
      margin-bottom: 2rem;
    }
    
    .hero-content h1 {
      font-size: 2.5rem;
      font-weight: 800;
      margin-bottom: 0.5rem;
      background: linear-gradient(to right, #fff, #a8edea, #fed6e3, #fff);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      animation: gradientShift 8s ease-in-out infinite;
      text-shadow: 0 0 40px rgba(255, 255, 255, 0.2);
    }
    
    .hero-content p {
      font-size: 1.1rem;
      opacity: 0.9;
    }
    
    @keyframes gradientShift {
      0%, 100% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
    }
    
    /* Student grid */
    .student-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
      gap: 2rem;
      margin-bottom: 2rem;
    }
    
    .student-card {
      background: var(--glass-bg);
      backdrop-filter: blur(var(--glass-blur));
      -webkit-backdrop-filter: blur(var(--glass-blur));
      border-radius: 20px;
      border: 1px solid var(--glass-border);
      padding: 0;
      overflow: hidden;
      transition: all 0.3s ease;
      color: white;
    }
    
    .student-card * {
      color: inherit;
    }
    
    .student-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 15px 40px rgba(0, 0, 0, 0.3);
    }
    
    .student-card-header {
      padding: 1.5rem;
      background: rgba(255, 255, 255, 0.05);
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }
    
    .student-info {
      display: flex;
      align-items: center;
      gap: 1rem;
    }
    
    .student-avatar {
      width: 50px;
      height: 50px;
      background: var(--gradient-3);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.5rem;
      color: white;
      box-shadow: 0 5px 15px rgba(79, 172, 254, 0.4);
    }
    
    .student-details h3 {
      margin: 0;
      font-size: 1.25rem;
      font-weight: 600;
      color: white;
    }
    
    .student-status {
      display: inline-flex;
      align-items: center;
      gap: 0.25rem;
      font-size: 0.875rem;
      padding: 0.25rem 0.75rem;
      border-radius: 20px;
      margin-top: 0.25rem;
    }
    
    .student-status.active {
      background: rgba(67, 233, 123, 0.2);
      color: #43e97b;
      border: 1px solid rgba(67, 233, 123, 0.3);
    }
    
    .student-status.inactive {
      background: rgba(239, 68, 68, 0.2);
      color: #ef4444;
      border: 1px solid rgba(239, 68, 68, 0.3);
    }
    
    .student-card-body {
      padding: 1.5rem;
    }
    
    .student-schedule {
      display: flex;
      gap: 1rem;
      margin-bottom: 1.5rem;
    }
    
    .schedule-badge {
      flex: 1;
      background: rgba(255, 255, 255, 0.05);
      padding: 0.75rem;
      border-radius: 12px;
      text-align: center;
      font-size: 0.875rem;
      border: 1px solid rgba(255, 255, 255, 0.1);
      color: white;
    }
    
    .schedule-badge strong {
      color: white;
    }
    
    .info-row {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      padding: 0.5rem 0;
      font-size: 0.9rem;
      opacity: 0.9;
      color: white;
    }
    
    .info-row i {
      color: #667eea;
    }
    
    .locations-section {
      margin-top: 1rem;
      padding-top: 1rem;
      border-top: 1px solid rgba(255, 255, 255, 0.1);
    }
    
    .locations-section h4 {
      color: white;
    }
    
    .location-badge {
      display: inline-block;
      background: rgba(255, 255, 255, 0.05);
      padding: 0.5rem 1rem;
      border-radius: 20px;
      font-size: 0.875rem;
      margin: 0.25rem;
      border: 1px solid rgba(255, 255, 255, 0.1);
      color: white;
    }
    
    .student-card-actions {
      display: flex;
      gap: 0.5rem;
      margin-top: 1.5rem;
      padding-top: 1.5rem;
      border-top: 1px solid rgba(255, 255, 255, 0.1);
    }
    
    /* Empty state */
    .empty-state {
      text-align: center;
      padding: 5rem 2rem;
      color: white;
    }
    
    .empty-state i {
      font-size: 5rem;
      opacity: 0.3;
      margin-bottom: 1rem;
    }
    
    .empty-state h3 {
      font-size: 1.75rem;
      margin-bottom: 0.5rem;
    }
    
    .empty-state p {
      opacity: 0.7;
      margin-bottom: 2rem;
    }
    
    /* Modal styling */
    .modal-content {
      background: #1a1a2e;
      backdrop-filter: blur(20px);
      -webkit-backdrop-filter: blur(20px);
      border: 1px solid rgba(255, 255, 255, 0.2);
      border-radius: 20px;
      color: white;
    }
    
    .modal-header {
      background: rgba(255, 255, 255, 0.05);
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 20px 20px 0 0;
    }
    
    .modal-footer {
      background: rgba(255, 255, 255, 0.05);
      border-top: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 0 0 20px 20px;
    }
    
    .btn-close {
      filter: invert(1);
      opacity: 0.8;
    }
    
    .btn-close:hover {
      opacity: 1;
    }
    
    /* Form sections */
    fieldset {
      margin-top: 2rem;
      padding: 1.5rem;
      background: rgba(255, 255, 255, 0.05);
      border-radius: 16px;
      border: 1px solid rgba(255, 255, 255, 0.1);
    }
    
    legend {
      font-size: 1.1rem;
      font-weight: 600;
      padding: 0 1rem;
      width: auto;
    }
    
    /* Animations */
    .fade-in {
      opacity: 0;
      transform: translateY(30px);
      animation: fadeInUp 0.8s ease-out forwards;
    }
    
    @keyframes fadeInUp {
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    
    /* Responsive design */
    @media (max-width: 768px) {
      .navbar-glass {
        padding: 0.75rem 0;
      }
      
      .navbar-brand {
        font-size: 1.25rem;
      }
      
      .hero-section {
        padding: 1.5rem 0;
      }
      
      .hero-content h1 {
        font-size: 2rem;
      }
      
      .metrics-grid {
        grid-template-columns: repeat(2, 1fr);
        gap: 1rem;
      }
      
      .metric-card {
        padding: 1rem;
      }
      
      .student-grid {
        grid-template-columns: 1fr;
        gap: 1.5rem;
      }
      
      .glass-card {
        padding: 1.5rem;
        border-radius: 16px;
      }
      
      .btn-group {
        display: none;
      }
    }
    
    /* Global text color fix */
    .container,
    .modal-body,
    .modal-header,
    .modal-footer {
      color: white;
    }
    
    /* Ensure all headings are white */
    h1, h2, h3, h4, h5, h6 {
      color: white;
    }
    
    /* Ensure all paragraphs and spans are white */
    p, span, div {
      color: inherit;
    }
      .container {
        padding-left: 1rem;
        padding-right: 1rem;
      }
      
      .hero-content h1 {
        font-size: 1.75rem;
      }
      
      .metrics-grid {
        grid-template-columns: 1fr;
      }
      
      .student-schedule {
        flex-direction: column;
      }
    }
    
    /* Button group styling */
    .btn-group .btn {
      border-radius: 0;
      border-right: 1px solid rgba(255, 255, 255, 0.2);
    }
    
    .btn-group .btn:first-child {
      border-radius: 15px 0 0 15px;
    }
    
    .btn-group .btn:last-child {
      border-radius: 0 15px 15px 0;
      border-right: none;
    }
    
    .btn-group .btn.active {
      background: rgba(255, 255, 255, 0.2);
      border-color: rgba(255, 255, 255, 0.3);
    }
    
    .btn-outline-light {
      background: transparent;
      border: 1px solid rgba(255, 255, 255, 0.3);
      color: white;
    }
    
    .btn-outline-light:hover {
      background: rgba(255, 255, 255, 0.1);
      border-color: rgba(255, 255, 255, 0.5);
      color: white;
    }
    
    /* Global text color fixes */
    .container {
      color: white;
    }
    
    .modal-body,
    .modal-header,
    .modal-footer {
      color: white;
    }
    
    h1, h2, h3, h4, h5, h6 {
      color: white;
    }
    
    p {
      color: white;
    }
    
    /* Screen reader only */
    .sr-only {
      position: absolute;
      width: 1px;
      height: 1px;
      padding: 0;
      margin: -1px;
      overflow: hidden;
      clip: rect(0, 0, 0, 0);
      white-space: nowrap;
      border-width: 0;
    }
    
    /* Ensure all text elements are white by default */
    body, 
    .container,
    .student-card,
    .glass-card,
    .modal-content,
    .modal-body,
    .modal-header,
    .modal-footer,
    .stat-card,
    .metric-card {
      color: white;
    }
    
    /* Ensure form elements text is white */
    input, select, textarea, option {
      color: white;
    }
    
    /* Form labels */
    .form-label {
      font-weight: 600;
      margin-bottom: 0.5rem;
      display: block;
      font-size: 0.9rem;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      opacity: 0.9;
      color: white;
    }
    
    .form-label.required::after {
      content: " *";
      color: #ef4444;
    }
    
    /* Form switch */
    .form-check-input:checked {
      background-color: #667eea;
      border-color: #667eea;
    }
    
    .form-check-label {
      color: white;
    }
    
    /* Stats grid */
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 1.5rem;
      margin-bottom: 3rem;
    }
    
    .stat-card {
      background: var(--glass-bg);
      backdrop-filter: blur(var(--glass-blur));
      -webkit-backdrop-filter: blur(var(--glass-blur));
      border-radius: 16px;
      padding: 1.5rem;
      text-align: center;
      border: 1px solid var(--glass-border);
      position: relative;
      overflow: hidden;
    }
    
    .stat-number {
      display: block;
      font-size: 2rem;
      font-weight: 700;
      background: var(--gradient-1);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      margin-bottom: 0.5rem;
    }
    
    .stat-label {
      font-size: 0.875rem;
      opacity: 0.8;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      color: white;
    }
    
    /* Section styling */
    section {
      margin-bottom: 3rem;
    }
    
    section h2 {
      font-size: 1.5rem;
      font-weight: 700;
      margin-bottom: 1.5rem;
      color: white;
    }
    
    /* Global text color fix */
    .container,
    .modal-body,
    .modal-header,
    .modal-footer {
      color: white;
    }
    
    /* Ensure all headings are white */
    h1, h2, h3, h4, h5, h6 {
      color: white;
    }
    
    /* Ensure legend text is white */
    legend {
      color: white;
    }
  
    /* CSP-compliant style replacements */
    .opacity-90 { opacity: 0.9; }
    .opacity-80 { opacity: 0.8; }
    .opacity-70 { opacity: 0.7; }
    .opacity-60 { opacity: 0.6; }
    .opacity-50 { opacity: 0.5; }
    
    .text-lg { font-size: 1.1rem; }
    .text-xl { font-size: 1.5rem; }
    .text-md { font-size: 1.25rem; }
    .text-sm { font-size: 0.9rem; }
    
    .text-muted-sm {
      opacity: 0.8;
      font-size: 0.9rem;
    }
    
    .empty-icon {
      font-size: 4rem;
      opacity: 0.5;
    }
    
    .gradient-text-2 {
      background: var(--gradient-2);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }
    
    .gradient-text-3 {
      background: var(--gradient-3);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }
    
    .gradient-text-4 {
      background: var(--gradient-4);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }
    
    .text-blue-light { color: #4facfe; }
    
    .info-box-light {
      background: rgba(255, 255, 255, 0.05);
      border-radius: 20px;
    }
    
    .mb-4 { margin-bottom: 1.5rem; }
</style>
    <!-- Dark Theme Text Colors -->
    <link rel="stylesheet" href="/static/dark_theme_text.css">
</head>
<body>
  
  <!-- Navigation -->
  <nav class="navbar navbar-glass">
    <div class="container-fluid">
      <a class="navbar-brand" href="/driver-dashboard">
        <i class="bi bi-bus-front-fill"></i> Fleet Management
      </a>
      <div class="d-flex align-items-center gap-3">
        <span class="text-white">
          <i class="bi bi-person-circle"></i> {{.User.Username}}
        </span>
        <div class="btn-group btn-group-sm" role="group">
          <a href="/driver-dashboard" class="btn btn-outline-light" title="Dashboard">
            <i class="bi bi-speedometer2"></i> Dashboard
          </a>
          <a href="/students" class="btn btn-outline-light active" title="Students">
            <i class="bi bi-people"></i> Students
          </a>
          <a href="/reports" class="btn btn-outline-light" title="Reports">
            <i class="bi bi-graph-up"></i> Reports
          </a>
        </div>
        <a href="/logout" class="btn btn-outline-light btn-sm">
          <i class="bi bi-box-arrow-right"></i> Logout
        </a>
      </div>
    </div>
  </nav>
  
  <!-- Hero Section -->
  <section class="hero-section">
    <div class="container">
      <div class="hero-content">
        <h1 class="fade-in">Student Management</h1>
        <p class="fade-in">Manage student roster and transportation details</p>
      </div>
    </div>
  </section>
  
  <div class="container">
    <!-- Statistics -->
    <div class="stats-grid fade-in">
      <div class="stat-card">
        <span class="stat-number" id="totalStudents">{{len .Data.Students}}</span>
        <div class="stat-label">Total Students</div>
      </div>
      <div class="stat-card">
        <span class="stat-number" id="activeStudents">0</span>
        <div class="stat-label">Active Students</div>
      </div>
      <div class="stat-card">
        <span class="stat-number" id="morningPickups">0</span>
        <div class="stat-label">Morning Pickups</div>
      </div>
      <div class="stat-card">
        <span class="stat-number" id="afternoonDropoffs">0</span>
        <div class="stat-label">Afternoon Dropoffs</div>
      </div>
    </div>
    
    <!-- Action Buttons -->
    <div class="text-end mb-4 fade-in">
      <a href="/add-student-wizard" class="btn btn-primary">
        <i class="bi bi-person-plus-fill"></i> Add New Student
      </a>
    </div>
    
    <!-- Students Section -->
    <section class="fade-in">
      <h2>All Students</h2>
      
      {{if .Data.Students}}
      <div class="student-grid">
        {{range .Data.Students}}
        <div class="student-card">
          <div class="student-card-header">
            <div class="student-info">
              <div class="student-avatar">
                <i class="bi bi-person-fill"></i>
              </div>
              <div class="student-details">
                <h3>{{.Name}}</h3>
                <span class="student-status {{if .Active}}active{{else}}inactive{{end}}">
                  {{if .Active}}
                    <i class="bi bi-check-circle-fill"></i> Active
                  {{else}}
                    <i class="bi bi-x-circle"></i> Inactive
                  {{end}}
                </span>
              </div>
            </div>
          </div>
          
          <div class="student-card-body">
            <!-- Schedule -->
            <div class="student-schedule">
              <div class="schedule-badge">
                <i class="bi bi-sunrise"></i>
                <div>Morning</div>
                <strong>{{if .PickupTime}}{{.PickupTime}}{{else}}Not Set{{end}}</strong>
              </div>
              <div class="schedule-badge">
                <i class="bi bi-sunset"></i>
                <div>Afternoon</div>
                <strong>{{if .DropoffTime}}{{.DropoffTime}}{{else}}Not Set{{end}}</strong>
              </div>
            </div>
            
            <!-- Contact Information -->
            <div class="info-row">
              <i class="bi bi-person-heart"></i>
              <span>{{.Guardian}}</span>
            </div>
            <div class="info-row">
              <i class="bi bi-telephone"></i>
              <span>{{.PhoneNumber}}</span>
            </div>
            {{if .AltPhoneNumber}}
            <div class="info-row">
              <i class="bi bi-telephone-plus"></i>
              <span>{{.AltPhoneNumber}}</span>
            </div>
            {{end}}
            
            <!-- Locations -->
            {{if and .Locations (ne .Locations "[]")}}
            <div class="locations-section">
              <h4 class="small mb-2" class="opacity-80">Locations:</h4>
              <span class="location-badge">
                <i class="bi bi-geo-alt-fill"></i>
                <span class="location-text" data-locations='{{.Locations}}'>View Locations</span>
              </span>
            </div>
            {{end}}
            
            <!-- Actions -->
            <div class="student-card-actions">
              <button type="button" class="btn btn-sm btn-outline-primary edit-student-btn" 
                      data-student-id="{{.StudentID}}" 
                      data-name="{{.Name}}" 
                      data-phone="{{.PhoneNumber}}" 
                      data-alt-phone="{{.AltPhoneNumber}}" 
                      data-guardian="{{.Guardian}}" 
                      data-pickup-time="{{.PickupTime}}" 
                      data-dropoff-time="{{.DropoffTime}}" 
                      data-route-id="{{.RouteID}}" 
                      data-active="{{.Active}}"
                      data-locations='{{.Locations}}'>
                <i class="bi bi-pencil"></i> Edit
              </button>
              <form method="POST" action="/remove-student" class="remove-student-form" style="display: inline;">
                <input type="hidden" name="csrf_token" value="{{$.Data.CSRFToken}}">
                <input type="hidden" name="student_id" value="{{.StudentID}}">
                <button type="submit" class="btn btn-sm btn-outline-danger">
                  <i class="bi bi-trash"></i> Remove
                </button>
              </form>
            </div>
          </div>
        </div>
        {{end}}
      </div>
      {{else}}
      <div class="empty-state">
        <i class="bi bi-people"></i>
        <h3>No Students Added Yet</h3>
        <p>Get started by adding your first student to the roster</p>
        <a href="/add-student-wizard" class="btn btn-primary">
          <i class="bi bi-person-plus-fill"></i> Add First Student
        </a>
      </div>
      {{end}}
    </section>
  </div>
  
  <!-- Add Student Modal -->
  <div class="modal fade" id="addStudentModal" tabindex="-1" aria-labelledby="addStudentModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header">
          <h2 class="modal-title" id="addStudentModalLabel">Add New Student</h2>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <form method="POST" action="/add-student">
          <input type="hidden" name="csrf_token" value="{{$.Data.CSRFToken}}">
          <div class="modal-body">
            <div class="mb-3">
              <label for="name" class="form-label required">Student Name</label>
              <input type="text" id="name" name="name" class="form-control" placeholder="Enter student's full name" required>
            </div>
            
            <div class="row">
              <div class="col-md-6 mb-3">
                <label for="guardian" class="form-label required">Guardian/Contact Person</label>
                <input type="text" id="guardian" name="guardian" class="form-control" placeholder="Parent or guardian name" required>
              </div>
              <div class="col-md-6 mb-3">
                <label for="route_id" class="form-label required">Route</label>
                <select id="route_id" name="route_id" class="form-select" required>
                  <option value="">Select Route</option>
                  {{range .Data.Routes}}
                  <option value="{{.RouteID}}">{{.RouteName}}</option>
                  {{end}}
                </select>
              </div>
            </div>
            
            <div class="row">
              <div class="col-md-6 mb-3">
                <label for="phone_number" class="form-label required">Phone Number</label>
                <input type="tel" id="phone_number" name="phone_number" class="form-control" placeholder="123-456-7890" required>
              </div>
              <div class="col-md-6 mb-3">
                <label for="alt_phone_number" class="form-label">Alternate Phone</label>
                <input type="tel" id="alt_phone_number" name="alt_phone_number" class="form-control" placeholder="123-456-7890">
              </div>
            </div>
            
            <div class="row">
              <div class="col-md-6 mb-3">
                <label for="pickup_time" class="form-label">Pickup Time</label>
                <input type="time" id="pickup_time" name="pickup_time" class="form-control">
              </div>
              <div class="col-md-6 mb-3">
                <label for="dropoff_time" class="form-label">Dropoff Time</label>
                <input type="time" id="dropoff_time" name="dropoff_time" class="form-control">
              </div>
            </div>
            
            <fieldset>
              <legend>Pickup Locations</legend>
              <div id="pickupLocations">
                <div class="row mb-2">
                  <div class="col-md-6">
                    <input type="text" class="form-control pickup-address" name="pickup_address" placeholder="123 Main Street">
                  </div>
                  <div class="col-md-6">
                    <input type="text" class="form-control" name="pickup_description" placeholder="Description (optional)">
                  </div>
                </div>
              </div>
              <button type="button" class="btn btn-sm btn-outline-primary add-pickup-location">
                <i class="bi bi-plus-circle"></i> Add Another Pickup Location
              </button>
            </fieldset>
            
            <fieldset>
              <legend>Dropoff Locations</legend>
              <div id="dropoffLocations">
                <div class="row mb-2">
                  <div class="col-md-6">
                    <input type="text" class="form-control dropoff-address" name="dropoff_address" placeholder="123 School Street">
                  </div>
                  <div class="col-md-6">
                    <input type="text" class="form-control" name="dropoff_description" placeholder="Description (optional)">
                  </div>
                </div>
              </div>
              <button type="button" class="btn btn-sm btn-outline-primary add-dropoff-location">
                <i class="bi bi-plus-circle"></i> Add Another Dropoff Location
              </button>
            </fieldset>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
            <button type="submit" class="btn btn-primary">Add Student</button>
          </div>
        </form>
      </div>
    </div>
  </div>
  
  <!-- Edit Student Modal -->
  <div class="modal fade" id="editStudentModal" tabindex="-1" aria-labelledby="editStudentModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header">
          <h2 class="modal-title" id="editStudentModalLabel">Edit Student</h2>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <form method="POST" action="/edit-student">
          <input type="hidden" name="csrf_token" value="{{$.Data.CSRFToken}}">
          <input type="hidden" name="student_id" id="edit_student_id">
          <input type="hidden" name="position_number" id="edit_position_number" value="0">
          <div class="modal-body">
            <div class="mb-3">
              <label for="edit_name" class="form-label required">Student Name</label>
              <input type="text" id="edit_name" name="name" class="form-control" required>
            </div>
            
            <div class="row">
              <div class="col-md-6 mb-3">
                <label for="edit_guardian" class="form-label required">Guardian/Contact Person</label>
                <input type="text" id="edit_guardian" name="guardian" class="form-control" required>
              </div>
              <div class="col-md-6 mb-3">
                <label for="edit_route_id" class="form-label">Route</label>
                <select id="edit_route_id" name="route_id" class="form-select">
                  <option value="">No Route Assigned</option>
                  {{range .Data.Routes}}
                  <option value="{{.RouteID}}">{{.RouteName}}</option>
                  {{end}}
                </select>
              </div>
            </div>
            
            <div class="row">
              <div class="col-md-4 mb-3">
                <label for="edit_phone_number" class="form-label required">Phone Number</label>
                <input type="tel" id="edit_phone_number" name="phone_number" class="form-control" required>
              </div>
              <div class="col-md-4 mb-3">
                <label for="edit_alt_phone_number" class="form-label">Alt Phone Number</label>
                <input type="tel" id="edit_alt_phone_number" name="alt_phone_number" class="form-control">
              </div>
              <div class="col-md-4 mb-3">
                <label for="edit_active" class="form-label">Status</label>
                <div class="form-check form-switch">
                  <input class="form-check-input" type="checkbox" id="edit_active" name="active">
                  <label class="form-check-label" for="edit_active">Active Student</label>
                </div>
              </div>
            </div>
            
            <div class="row">
              <div class="col-md-6 mb-3">
                <label for="edit_pickup_time" class="form-label">Pickup Time</label>
                <input type="time" id="edit_pickup_time" name="pickup_time" class="form-control">
              </div>
              <div class="col-md-6 mb-3">
                <label for="edit_dropoff_time" class="form-label">Dropoff Time</label>
                <input type="time" id="edit_dropoff_time" name="dropoff_time" class="form-control">
              </div>
            </div>
            
            <fieldset>
              <legend>Pickup Locations</legend>
              <div id="editPickupLocations"></div>
              <button type="button" class="btn btn-sm btn-outline-primary add-edit-pickup-location">
                <i class="bi bi-plus-circle"></i> Add Another Pickup Location
              </button>
            </fieldset>
            
            <fieldset>
              <legend>Dropoff Locations</legend>
              <div id="editDropoffLocations"></div>
              <button type="button" class="btn btn-sm btn-outline-primary add-edit-dropoff-location">
                <i class="bi bi-plus-circle"></i> Add Another Dropoff Location
              </button>
            </fieldset>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
            <button type="submit" class="btn btn-primary">Update Student</button>
          </div>
        </form>
      </div>
    </div>
  </div>
  
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  
  <script nonce="{{.CSPNonce}}">
    document.addEventListener('DOMContentLoaded', function() {
      // CSP-compliant event listeners
      document.querySelectorAll('[data-action]').forEach(element => {
        element.addEventListener('click', function(e) {
          e.preventDefault();
          const action = this.dataset.action;
          
          switch(action) {
            case 'update-status':
              updateStatus(this.dataset.id, this.dataset.type, this.dataset.value);
              break;
            case 'edit-bus':
              editBus(this.dataset.busId);
              break;
            case 'delete-bus':
              deleteBus(this.dataset.busId);
              break;
            case 'custom':
              // Evaluate the original onclick content (careful with this)
              try {
                eval(this.dataset.onclick);
              } catch (e) { /* Error handled silently */ }
              break;
          }
        });
      });

      // Calculate statistics
      {{if .Data.Students}}
      const students = [
        {{range .Data.Students}}
        {active: {{.Active}}, pickupTime: "{{.PickupTime}}", dropoffTime: "{{.DropoffTime}}"},
        {{end}}
      ];
      
      const activeCount = students.filter(s => s.active).length;
      const morningCount = students.filter(s => s.pickupTime && s.pickupTime < "12:00").length;
      const afternoonCount = students.filter(s => s.dropoffTime && s.dropoffTime >= "12:00").length;
      
      document.getElementById('activeStudents').textContent = activeCount;
      document.getElementById('morningPickups').textContent = morningCount;
      document.getElementById('afternoonDropoffs').textContent = afternoonCount;
      {{end}}
      
      // Handle location additions
      document.addEventListener('click', function(e) {
        if (e.target.closest('.add-pickup-location')) {
          addPickupLocation();
        }
        if (e.target.closest('.add-dropoff-location')) {
          addDropoffLocation();
        }
        if (e.target.closest('.add-edit-pickup-location')) {
          addEditPickupLocation();
        }
        if (e.target.closest('.add-edit-dropoff-location')) {
          addEditDropoffLocation();
        }
        if (e.target.closest('.edit-student-btn')) {
          const btn = e.target.closest('.edit-student-btn');
          editStudent(btn.dataset);
        }
      });
      
      // Confirm removal
      document.querySelectorAll('.remove-student-form').forEach(form => {
        form.addEventListener('submit', function(e) {
          if (!confirm('Are you sure you want to remove this student? This action cannot be undone.')) {
            e.preventDefault();
          }
        });
      });
      
      function addPickupLocation() {
        const container = document.getElementById('pickupLocations');
        const div = document.createElement('div');
        div.className = 'row mb-2';
        div.innerHTML = `
          <div class="col-md-6">
            <input type="text" class="form-control pickup-address" name="pickup_address" placeholder="123 Main Street">
          </div>
          <div class="col-md-6">
            <input type="text" class="form-control" name="pickup_description" placeholder="Description (optional)">
          </div>
        `;
        container.appendChild(div);
      }
      
      function addDropoffLocation() {
        const container = document.getElementById('dropoffLocations');
        const div = document.createElement('div');
        div.className = 'row mb-2';
        div.innerHTML = `
          <div class="col-md-6">
            <input type="text" class="form-control dropoff-address" name="dropoff_address" placeholder="123 School Street">
          </div>
          <div class="col-md-6">
            <input type="text" class="form-control" name="dropoff_description" placeholder="Description (optional)">
          </div>
        `;
        container.appendChild(div);
      }
      
      function addEditPickupLocation() {
        const container = document.getElementById('editPickupLocations');
        const div = document.createElement('div');
        div.className = 'row mb-2';
        div.innerHTML = `
          <div class="col-md-6">
            <input type="text" class="form-control pickup-address" name="pickup_address" placeholder="123 Main Street">
          </div>
          <div class="col-md-6">
            <input type="text" class="form-control" name="pickup_description" placeholder="Description (optional)">
          </div>
        `;
        container.appendChild(div);
      }
      
      function addEditDropoffLocation() {
        const container = document.getElementById('editDropoffLocations');
        const div = document.createElement('div');
        div.className = 'row mb-2';
        div.innerHTML = `
          <div class="col-md-6">
            <input type="text" class="form-control dropoff-address" name="dropoff_address" placeholder="123 School Street">
          </div>
          <div class="col-md-6">
            <input type="text" class="form-control" name="dropoff_description" placeholder="Description (optional)">
          </div>
        `;
        container.appendChild(div);
      }
      
      function escapeHtml(unsafe) {
        return unsafe
          .replace(/&/g, "&amp;")
          .replace(/</g, "&lt;")
          .replace(/>/g, "&gt;")
          .replace(/"/g, "&quot;")
          .replace(/'/g, "&#039;");
      }
      
      function editStudent(data) {
        // Clear previous locations first
        document.getElementById('editPickupLocations').innerHTML = '';
        document.getElementById('editDropoffLocations').innerHTML = '';
        
        // Populate form fields
        document.getElementById('edit_student_id').value = data.studentId;
        document.getElementById('edit_name').value = data.name;
        document.getElementById('edit_phone_number').value = data.phone;
        document.getElementById('edit_alt_phone_number').value = data.altPhone || '';
        document.getElementById('edit_guardian').value = data.guardian;
        document.getElementById('edit_pickup_time').value = data.pickupTime || '';
        document.getElementById('edit_dropoff_time').value = data.dropoffTime || '';
        document.getElementById('edit_route_id').value = data.routeId;
        document.getElementById('edit_active').checked = data.active === 'true';
        
        // Populate locations
        try {
          const locations = JSON.parse(data.locations || '[]');
          
          locations.forEach(function(location) {
            if (location.Type === 'pickup') {
              const container = document.getElementById('editPickupLocations');
              const div = document.createElement('div');
              div.className = 'row mb-2';
              const address = escapeHtml(location.Address || '');
              const description = escapeHtml(location.Description || '');
              div.innerHTML = `
                <div class="col-md-6">
                  <input type="text" class="form-control pickup-address" name="pickup_address" value="${address}" placeholder="123 Main Street">
                </div>
                <div class="col-md-6">
                  <input type="text" class="form-control" name="pickup_description" value="${description}" placeholder="Description (optional)">
                </div>
              `;
              container.appendChild(div);
            } else if (location.Type === 'dropoff') {
              const container = document.getElementById('editDropoffLocations');
              const div = document.createElement('div');
              div.className = 'row mb-2';
              const address = escapeHtml(location.Address || '');
              const description = escapeHtml(location.Description || '');
              div.innerHTML = `
                <div class="col-md-6">
                  <input type="text" class="form-control dropoff-address" name="dropoff_address" value="${address}" placeholder="123 School Street">
                </div>
                <div class="col-md-6">
                  <input type="text" class="form-control" name="dropoff_description" value="${description}" placeholder="Description (optional)">
                </div>
              `;
              container.appendChild(div);
            }
          });
        } catch (e) { /* Error handled silently */ }
        
        // Ensure at least one location input for each type
        if (document.getElementById('editPickupLocations').children.length === 0) {
          addEditPickupLocation();
        }
        if (document.getElementById('editDropoffLocations').children.length === 0) {
          addEditDropoffLocation();
        }
        
        const modal = new bootstrap.Modal(document.getElementById('editStudentModal'));
        modal.show();
      }
      
      // Parse and display locations
      document.querySelectorAll('.location-text').forEach(function(elem) {
        try {
          const locations = JSON.parse(elem.dataset.locations || '[]');
          if (locations.length > 0) {
            const addresses = locations.map(loc => loc.address || loc.Address || '').filter(a => a);
            if (addresses.length > 0) {
              elem.textContent = addresses.join(' â†’ ');
            }
          }
        } catch (e) {
          // If parsing fails, just leave the default text
        }
      });
      
      // Animate numbers
      function animateValue(element, start, end, duration) {
        let startTimestamp = null;
        const step = (timestamp) => {
          if (!startTimestamp) startTimestamp = timestamp;
          const progress = Math.min((timestamp - startTimestamp) / duration, 1);
          const value = Math.floor(progress * (end - start) + start);
          element.textContent = value;
          if (progress < 1) {
            window.requestAnimationFrame(step);
          }
        };
        window.requestAnimationFrame(step);
      }
      
      // Animate stat values on load
      document.querySelectorAll('.stat-number').forEach(el => {
        const value = parseInt(el.textContent);
        if (!isNaN(value)) {
          animateValue(el, 0, value, 1000);
        }
      });
    });
  </script>
  
  <!-- Include Loading Indicators System -->
  <script src="/static/loading_indicators.js"></script>
  
  <!-- Include Session Timeout Warning System -->
  <script src="/static/session_timeout_warning.js"></script>
  
  <!-- Include Touch-Friendly System -->
  <script src="/static/touch_friendly.js"></script>
  
  <script nonce="{{.CSPNonce}}">
    // Show loading indicator when fetching data
    document.addEventListener('DOMContentLoaded', function() {
      // Add loading states to any buttons that trigger actions
      document.querySelectorAll('form').forEach(form => {
        form.addEventListener('submit', function() {
          // Show progress loader for form submissions
          if (window.loadingIndicators) {
            loadingIndicators.showProgress('Saving changes...');
          }
        });
      });
      
      // Add loading to navigation links
      document.querySelectorAll('a.btn').forEach(link => {
        link.addEventListener('click', function(e) {
          if (!e.ctrlKey && !e.metaKey && window.loadingIndicators) {
            loadingIndicators.showProgress('Loading...');
          }
        });
      });
    });
  </script>
  <!-- jQuery and Bootstrap JS -->
  <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
