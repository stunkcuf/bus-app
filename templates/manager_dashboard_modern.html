<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Manager Dashboard - Fleet Management System</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">
  <link rel="stylesheet" href="/static/modern_design_system.css">
  <style nonce="{{.CSPNonce}}">
    /* Page specific styles */
    .hero-section {
      background: var(--grad-primary);
      color: white;
      padding: var(--space-xl) 0 var(--space-xl);
      margin-bottom: var(--space-xl);
      position: relative;
      overflow: hidden;
    }
    
    .hero-section::before {
      content: '';
      position: absolute;
      top: -50%;
      right: -50%;
      width: 200%;
      height: 200%;
      background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
      animation: rotate 30s linear infinite;
    }
    
    @keyframes rotate {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    
    .hero-content {
      position: relative;
      z-index: 1;
    }
    
    .welcome-message {
      font-size: 2.5rem;
      font-weight: 700;
      margin-bottom: var(--space-sm);
      animation: fadeInUp 0.6s ease-out;
    }
    
    .date-time {
      font-size: 1.1rem;
      opacity: 0.9;
      animation: fadeInUp 0.6s ease-out 0.1s both;
    }
    
    .stats-overview {
      display: flex;
      gap: var(--space-xl);
      margin-top: var(--space-lg);
      flex-wrap: wrap;
    }
    
    .stat-item {
      animation: fadeInUp 0.6s ease-out 0.2s both;
    }
    
    .stat-value {
      font-size: 3rem;
      font-weight: 700;
      line-height: 1;
    }
    
    .stat-label {
      font-size: 0.9rem;
      opacity: 0.9;
      text-transform: uppercase;
      letter-spacing: 1px;
    }
    
    /* Activity Feed */
    .activity-feed {
      max-height: 400px;
      overflow-y: auto;
    }
    
    .activity-item {
      display: flex;
      align-items: start;
      gap: var(--space-md);
      padding: var(--space-md);
      border-bottom: 1px solid rgba(0,0,0,0.05);
      transition: var(--transition-fast);
    }
    
    .activity-item:hover {
      background: rgba(102, 126, 234, 0.05);
    }
    
    .activity-icon {
      width: 40px;
      height: 40px;
      border-radius: var(--radius-round);
      display: flex;
      align-items: center;
      justify-content: center;
      flex-shrink: 0;
    }
    
    .activity-icon-success {
      background: rgba(17, 153, 142, 0.1);
      color: #11998e;
    }
    
    .activity-icon-warning {
      background: rgba(250, 112, 154, 0.1);
      color: #fa709a;
    }
    
    .activity-icon-info {
      background: rgba(79, 172, 254, 0.1);
      color: #4facfe;
    }
    
    .activity-time {
      font-size: 0.875rem;
      color: #6c757d;
    }
  </style>
</head>
<body>
  <div class="page-wrapper">
    <!-- Modern Navigation -->
    <nav class="modern-nav">
      <div class="container">
        <div class="d-flex justify-content-between align-items-center">
          <a href="/manager-dashboard" class="modern-nav-brand">
            <i class="bi bi-bus-front-fill"></i>
            Fleet Manager
          </a>
          <div class="d-flex align-items-center gap-3">
            <button class="btn btn-modern btn-modern-outline btn-sm">
              <i class="bi bi-bell"></i>
              <span class="badge bg-danger ms-1">{{.PendingAlerts}}</span>
            </button>
            <div class="dropdown">
              <button class="btn btn-modern btn-modern-primary btn-sm dropdown-toggle" data-bs-toggle="dropdown">
                <i class="bi bi-person-circle"></i>
                {{.User.Username}}
              </button>
              <ul class="dropdown-menu dropdown-menu-end">
                <li><a class="dropdown-item" href="/profile"><i class="bi bi-person me-2"></i>Profile</a></li>
                <li><a class="dropdown-item" href="/settings"><i class="bi bi-gear me-2"></i>Settings</a></li>
                <li><hr class="dropdown-divider"></li>
                <li>
                  <form method="POST" action="/logout" class="m-0">
                    <button type="submit" class="dropdown-item text-danger">
                      <i class="bi bi-box-arrow-right me-2"></i>Logout
                    </button>
                  </form>
                </li>
              </ul>
            </div>
          </div>
        </div>
      </div>
    </nav>
    
    <!-- Hero Section -->
    <section class="hero-section">
      <div class="container">
        <div class="hero-content">
          <h1 class="welcome-message">Welcome back, {{.User.Username}}!</h1>
          <p class="date-time">
            <i class="bi bi-calendar3 me-2"></i>{{.CurrentDate}} 
            <span class="ms-3"><i class="bi bi-clock me-2"></i><span id="current-time"></span></span>
          </p>
          <div class="stats-overview">
            <div class="stat-item">
              <div class="stat-value">{{.TotalBuses}}</div>
              <div class="stat-label">Total Fleet</div>
            </div>
            <div class="stat-item">
              <div class="stat-value">{{.ActiveBuses}}</div>
              <div class="stat-label">Active Buses</div>
            </div>
            <div class="stat-item">
              <div class="stat-value">{{.ActiveDrivers}}</div>
              <div class="stat-label">Active Drivers</div>
            </div>
            <div class="stat-item">
              <div class="stat-value">{{.TodayRoutes}}</div>
              <div class="stat-label">Today's Routes</div>
            </div>
          </div>
        </div>
      </div>
    </section>
    
    <div class="container">
      <!-- Quick Actions -->
      <section class="mb-5">
        <h2 class="h4 mb-4">Quick Actions</h2>
        <div class="row g-4">
          <div class="col-md-6 col-lg-3">
            <a href="/fleet" class="quick-action-card animate-fade-in">
              <div class="quick-action-icon">
                <i class="bi bi-bus-front"></i>
              </div>
              <div class="quick-action-content">
                <h3>Fleet Management</h3>
                <p>View and manage all buses</p>
              </div>
            </a>
          </div>
          <div class="col-md-6 col-lg-3">
            <a href="/assign-routes" class="quick-action-card animate-fade-in" style="animation-delay: 0.1s">
              <div class="quick-action-icon" style="background: var(--grad-success)">
                <i class="bi bi-map"></i>
              </div>
              <div class="quick-action-content">
                <h3>Assign Routes</h3>
                <p>Manage driver assignments</p>
              </div>
            </a>
          </div>
          <div class="col-md-6 col-lg-3">
            <a href="/ecse-dashboard" class="quick-action-card animate-fade-in" style="animation-delay: 0.2s">
              <div class="quick-action-icon" style="background: var(--grad-info)">
                <i class="bi bi-heart"></i>
              </div>
              <div class="quick-action-content">
                <h3>ECSE Students</h3>
                <p>Special education tracking</p>
              </div>
            </a>
          </div>
          <div class="col-md-6 col-lg-3">
            <a href="/fuel-tracking" class="quick-action-card animate-fade-in" style="animation-delay: 0.3s">
              <div class="quick-action-icon" style="background: var(--grad-warning)">
                <i class="bi bi-fuel-pump"></i>
              </div>
              <div class="quick-action-content">
                <h3>Fuel Records</h3>
                <p>Track fuel consumption</p>
              </div>
            </a>
          </div>
        </div>
      </section>
      
      <!-- Metrics Dashboard -->
      <section class="mb-5">
        <h2 class="h4 mb-4">Fleet Status Overview</h2>
        <div class="dashboard-grid">
          <!-- Active Buses -->
          <div class="metric-card metric-card-success animate-fade-in">
            <i class="bi bi-check-circle-fill metric-icon"></i>
            <div class="metric-value">{{.ActiveBuses}}</div>
            <div class="metric-label">Active Buses</div>
            <div class="mt-3">
              <small class="d-block">
                <i class="bi bi-arrow-up me-1"></i>{{.ActiveBusesPercent}}% of fleet
              </small>
            </div>
          </div>
          
          <!-- Maintenance Due -->
          <div class="metric-card metric-card-warning animate-fade-in" style="animation-delay: 0.1s">
            <i class="bi bi-tools metric-icon"></i>
            <div class="metric-value">{{.MaintenanceNeeded}}</div>
            <div class="metric-label">Maintenance Due</div>
            <div class="mt-3">
              <small class="d-block">
                {{if gt .MaintenanceNeeded 0}}
                  <i class="bi bi-exclamation-triangle me-1"></i>Action required
                {{else}}
                  <i class="bi bi-check me-1"></i>All good
                {{end}}
              </small>
            </div>
          </div>
          
          <!-- Pending Approvals -->
          <div class="metric-card metric-card-info animate-fade-in" style="animation-delay: 0.2s">
            <i class="bi bi-person-plus-fill metric-icon"></i>
            <div class="metric-value">{{.PendingUsers}}</div>
            <div class="metric-label">Pending Drivers</div>
            <div class="mt-3">
              <a href="/approve-users" class="text-white text-decoration-none">
                <small>Review now <i class="bi bi-arrow-right"></i></small>
              </a>
            </div>
          </div>
          
          <!-- Routes Today -->
          <div class="metric-card metric-card-primary animate-fade-in" style="animation-delay: 0.3s">
            <i class="bi bi-geo-alt-fill metric-icon"></i>
            <div class="metric-value">{{.AssignedRoutes}}</div>
            <div class="metric-label">Routes Assigned</div>
            <div class="mt-3">
              <small class="d-block">
                <i class="bi bi-clock me-1"></i>Today's schedule
              </small>
            </div>
          </div>
        </div>
      </section>
      
      <!-- Recent Activity & Alerts -->
      <div class="row">
        <div class="col-lg-8">
          <div class="modern-card animate-fade-in">
            <div class="modern-card-header">
              <h3 class="h5 mb-0">
                <i class="bi bi-activity me-2"></i>Recent Activity
              </h3>
            </div>
            <div class="modern-card-body p-0">
              <div class="activity-feed">
                {{if .RecentActivity}}
                  {{range .RecentActivity}}
                  <div class="activity-item">
                    <div class="activity-icon activity-icon-{{.Type}}">
                      <i class="bi bi-{{.Icon}}"></i>
                    </div>
                    <div class="flex-grow-1">
                      <p class="mb-1">{{.Message}}</p>
                      <span class="activity-time">{{.Time}}</span>
                    </div>
                  </div>
                  {{end}}
                {{else}}
                  <div class="empty-state">
                    <i class="bi bi-inbox empty-state-icon"></i>
                    <h3>No Recent Activity</h3>
                    <p>Activities will appear here as they happen</p>
                  </div>
                {{end}}
              </div>
            </div>
          </div>
        </div>
        
        <div class="col-lg-4">
          <div class="modern-card animate-fade-in" style="animation-delay: 0.2s">
            <div class="modern-card-header">
              <h3 class="h5 mb-0">
                <i class="bi bi-exclamation-triangle me-2"></i>Maintenance Alerts
              </h3>
            </div>
            <div class="modern-card-body">
              {{if .MaintenanceAlerts}}
                {{range .MaintenanceAlerts}}
                <div class="alert alert-{{.Severity}} d-flex align-items-center" role="alert">
                  <i class="bi bi-exclamation-circle-fill me-2"></i>
                  <div>
                    <strong>{{.VehicleID}}</strong><br>
                    <small>{{.Message}}</small>
                  </div>
                </div>
                {{end}}
              {{else}}
                <div class="text-center text-muted py-4">
                  <i class="bi bi-check-circle" style="font-size: 3rem; opacity: 0.3;"></i>
                  <p class="mt-2 mb-0">No maintenance alerts</p>
                </div>
              {{end}}
            </div>
          </div>
        </div>
      </div>
      
      <!-- Hidden Features Section -->
      <section class="mt-5 mb-5">
        <h2 class="h4 mb-4">Advanced Features</h2>
        <div class="row g-4">
          <!-- ECSE Management -->
          <div class="col-md-6">
            <div class="modern-card h-100">
              <div class="modern-card-body">
                <div class="d-flex align-items-center mb-3">
                  <div class="quick-action-icon me-3" style="background: var(--grad-info)">
                    <i class="bi bi-heart"></i>
                  </div>
                  <div>
                    <h4>ECSE Student Management</h4>
                    <p class="text-muted mb-0">Special Education Support</p>
                  </div>
                </div>
                <p>Track and manage Early Childhood Special Education students with dedicated features:</p>
                <ul class="list-unstyled">
                  <li><i class="bi bi-check-circle text-success me-2"></i>IEP Status Tracking</li>
                  <li><i class="bi bi-check-circle text-success me-2"></i>Service Minutes Monitoring</li>
                  <li><i class="bi bi-check-circle text-success me-2"></i>Transportation Requirements</li>
                  <li><i class="bi bi-check-circle text-success me-2"></i>Assessment Scheduling</li>
                </ul>
                <a href="/import-ecse" class="btn btn-modern btn-modern-info">
                  <i class="bi bi-upload"></i> Import ECSE Data
                </a>
              </div>
            </div>
          </div>
          
          <!-- Fuel Management -->
          <div class="col-md-6">
            <div class="modern-card h-100">
              <div class="modern-card-body">
                <div class="d-flex align-items-center mb-3">
                  <div class="quick-action-icon me-3" style="background: var(--grad-warning)">
                    <i class="bi bi-fuel-pump"></i>
                  </div>
                  <div>
                    <h4>Fuel Management System</h4>
                    <p class="text-muted mb-0">Track Consumption & Costs</p>
                  </div>
                </div>
                <p>Monitor fuel usage and optimize routes with comprehensive tracking:</p>
                <ul class="list-unstyled">
                  <li><i class="bi bi-check-circle text-success me-2"></i>Fuel Consumption Tracking</li>
                  <li><i class="bi bi-check-circle text-success me-2"></i>Cost Analysis per Vehicle</li>
                  <li><i class="bi bi-check-circle text-success me-2"></i>Efficiency Reports</li>
                  <li><i class="bi bi-check-circle text-success me-2"></i>Fuel Card Integration</li>
                </ul>
                <a href="/fuel-records" class="btn btn-modern btn-modern-warning">
                  <i class="bi bi-graph-up"></i> View Fuel Analytics
                </a>
              </div>
            </div>
          </div>
          
          <!-- Mileage Reports -->
          <div class="col-md-6">
            <div class="modern-card h-100">
              <div class="modern-card-body">
                <div class="d-flex align-items-center mb-3">
                  <div class="quick-action-icon me-3" style="background: var(--grad-success)">
                    <i class="bi bi-speedometer2"></i>
                  </div>
                  <div>
                    <h4>Mileage Tracking</h4>
                    <p class="text-muted mb-0">Detailed Trip Records</p>
                  </div>
                </div>
                <p>Comprehensive mileage tracking for compliance and maintenance:</p>
                <ul class="list-unstyled">
                  <li><i class="bi bi-check-circle text-success me-2"></i>Daily Driver Logs</li>
                  <li><i class="bi bi-check-circle text-success me-2"></i>Monthly Reports</li>
                  <li><i class="bi bi-check-circle text-success me-2"></i>Route Optimization</li>
                  <li><i class="bi bi-check-circle text-success me-2"></i>Compliance Reporting</li>
                </ul>
                <div class="btn-group">
                  <a href="/monthly-mileage-reports" class="btn btn-modern btn-modern-success">
                    <i class="bi bi-file-earmark-text"></i> View Reports
                  </a>
                  <a href="/import-mileage" class="btn btn-modern btn-modern-outline">
                    <i class="bi bi-upload"></i> Import
                  </a>
                </div>
              </div>
            </div>
          </div>
          
          <!-- Service Records -->
          <div class="col-md-6">
            <div class="modern-card h-100">
              <div class="modern-card-body">
                <div class="d-flex align-items-center mb-3">
                  <div class="quick-action-icon me-3" style="background: var(--grad-danger)">
                    <i class="bi bi-wrench-adjustable"></i>
                  </div>
                  <div>
                    <h4>Service & Maintenance</h4>
                    <p class="text-muted mb-0">Complete Service History</p>
                  </div>
                </div>
                <p>Track all maintenance activities and service schedules:</p>
                <ul class="list-unstyled">
                  <li><i class="bi bi-check-circle text-success me-2"></i>Service Record History</li>
                  <li><i class="bi bi-check-circle text-success me-2"></i>Maintenance Schedules</li>
                  <li><i class="bi bi-check-circle text-success me-2"></i>Cost Tracking</li>
                  <li><i class="bi bi-check-circle text-success me-2"></i>Vendor Management</li>
                </ul>
                <div class="btn-group">
                  <a href="/maintenance-records" class="btn btn-modern btn-modern-danger">
                    <i class="bi bi-journal-text"></i> Records
                  </a>
                  <a href="/service-records" class="btn btn-modern btn-modern-outline">
                    <i class="bi bi-calendar-check"></i> Schedule
                  </a>
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>
    </div>
  </div>
  
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script nonce="{{.CSPNonce}}">
    // Update current time
    function updateTime() {
      const now = new Date();
      const time = now.toLocaleTimeString('en-US', { 
        hour: '2-digit', 
        minute: '2-digit',
        hour12: true 
      });
      document.getElementById('current-time').textContent = time;
    }
    
    updateTime();
    setInterval(updateTime, 1000);
    
    // Add hover effects to cards
    document.querySelectorAll('.metric-card, .quick-action-card').forEach(card => {
      card.addEventListener('mouseenter', function() {
        this.style.transform = 'translateY(-5px) scale(1.02)';
      });
      
      card.addEventListener('mouseleave', function() {
        this.style.transform = 'translateY(0) scale(1)';
      });
    });
    
    // Animate numbers on page load
    function animateValue(element, start, end, duration) {
      let startTimestamp = null;
      const step = (timestamp) => {
        if (!startTimestamp) startTimestamp = timestamp;
        const progress = Math.min((timestamp - startTimestamp) / duration, 1);
        element.textContent = Math.floor(progress * (end - start) + start);
        if (progress < 1) {
          window.requestAnimationFrame(step);
        }
      };
      window.requestAnimationFrame(step);
    }
    
    // Animate metric values
    document.querySelectorAll('.metric-value').forEach(el => {
      const value = parseInt(el.textContent);
      if (!isNaN(value)) {
        animateValue(el, 0, value, 1000);
      }
    });
  </script>
</body>
</html>