<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Vehicle Maintenance - {{.Vehicle.VehicleID}}</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">
  <style>
    :root {
      --grad-primary: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      --grad-success: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
      --grad-info: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
      --grad-warning: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
      --grad-danger: linear-gradient(135deg, #ff6b6b 0%, #ffa726 100%);
    }
    
    body {
      background-color: #f8f9fa;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
    }
    
    .page-header {
      background: var(--grad-primary);
      color: white;
      padding: 1.5rem;
      border-radius: 15px;
      margin-bottom: 2rem;
      box-shadow: 0 10px 30px rgba(102, 126, 234, 0.3);
    }
    
    .page-header .btn {
      background: rgba(255,255,255,0.2);
      color: white;
      border: 1px solid rgba(255,255,255,0.3);
      transition: all 0.3s ease;
    }
    
    .page-header .btn:hover {
      background: rgba(255,255,255,0.3);
      transform: translateY(-2px);
      color: white;
    }
    
    .enhanced-card {
      border: none;
      border-radius: 15px;
      box-shadow: 0 5px 15px rgba(0,0,0,0.08);
      transition: all 0.3s ease;
      overflow: hidden;
    }
    
    .enhanced-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 15px 35px rgba(0,0,0,0.1);
    }
    
    .enhanced-card .card-header {
      background: linear-gradient(45deg, #f8f9fa, #e9ecef);
      border-bottom: 2px solid #dee2e6;
      padding: 1.25rem;
    }
    
    .vehicle-info-card {
      background: linear-gradient(135deg, rgba(102, 126, 234, 0.1), rgba(118, 75, 162, 0.1));
      border-left: 4px solid #667eea;
    }
    
    .service-status-card {
      background: linear-gradient(135deg, rgba(17, 153, 142, 0.1), rgba(56, 239, 125, 0.1));
      border-left: 4px solid #11998e;
    }
    
    .maintenance-log-card {
      background: linear-gradient(135deg, rgba(79, 172, 254, 0.1), rgba(0, 242, 254, 0.1));
      border-left: 4px solid #4facfe;
    }
    
    .info-label {
      font-weight: 600;
      color: #6c757d;
      display: inline-block;
      min-width: 120px;
    }
    
    .info-value {
      font-weight: 500;
      color: #495057;
    }
    
    .status-badge {
      padding: 0.5rem 1rem;
      border-radius: 20px;
      font-size: 0.85rem;
      font-weight: 500;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    
    .status-good { background: var(--grad-success); color: white; }
    .status-due { background: var(--grad-warning); color: white; }
    .status-overdue { background: var(--grad-danger); color: white; }
    
    .service-metric {
      text-align: center;
      padding: 1rem;
    }
    
    .service-metric-value {
      font-size: 2rem;
      font-weight: 700;
      color: #667eea;
      display: block;
    }
    
    .service-metric-label {
      font-size: 0.9rem;
      color: #6c757d;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    
    .table-container {
      max-height: 400px;
      overflow-y: auto;
    }
    
    .form-control, .form-select {
      border: 2px solid #e9ecef;
      border-radius: 10px;
      padding: 0.75rem 1rem;
      transition: all 0.3s ease;
    }
    
    .form-control:focus, .form-select:focus {
      border-color: #667eea;
      box-shadow: 0 0 0 0.2rem rgba(102, 126, 234, 0.25);
    }
    
    .btn-primary {
      background: var(--grad-primary);
      border: none;
      padding: 0.75rem 2rem;
      border-radius: 10px;
      font-weight: 600;
      transition: all 0.3s ease;
    }
    
    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
      background: var(--grad-primary);
    }
  </style>
</head>
<body>
  <div class="container-fluid py-4">
    <!-- Header -->
    <header class="page-header">
      <div class="d-flex justify-content-between align-items-center flex-wrap">
        <div>
          <h1 class="fs-3 mb-1">
            <i class="bi bi-wrench-adjustable me-2"></i>Vehicle Maintenance
          </h1>
          <p class="mb-0 opacity-75">Complete maintenance history for {{.Vehicle.VehicleID}}</p>
        </div>
        <nav class="btn-group btn-group-sm" role="group">
          <a href="/company-fleet" class="btn">
            <i class="bi bi-arrow-left me-1"></i>Back to Fleet
          </a>
          <a href="/dashboard" class="btn">
            <i class="bi bi-speedometer2 me-1"></i>Dashboard
          </a>
          <a href="/logout" class="btn">
            <i class="bi bi-box-arrow-right me-1"></i>Logout
          </a>
        </nav>
      </div>
    </header>

    <!-- Vehicle Information -->
    <div class="row g-4 mb-4">
      <div class="col-lg-6">
        <div class="enhanced-card vehicle-info-card">
          <div class="card-header">
            <h5 class="mb-0"><i class="bi bi-truck me-2"></i>Vehicle Information</h5>
          </div>
          <div class="card-body">
            <div class="row mb-2">
              <div class="col-6">
                <span class="info-label">Vehicle ID:</span>
                <span class="info-value">{{.Vehicle.VehicleID}}</span>
              </div>
              <div class="col-6">
                <span class="info-label">Model:</span>
                <span class="info-value">{{if .Vehicle.Model}}{{.Vehicle.Model}}{{else}}Not specified{{end}}</span>
              </div>
            </div>
            <div class="row mb-2">
              <div class="col-6">
                <span class="info-label">Year:</span>
                <span class="info-value">{{if .Vehicle.Year}}{{.Vehicle.Year}}{{else}}N/A{{end}}</span>
              </div>
              <div class="col-6">
                <span class="info-label">Serial #:</span>
                <span class="info-value">{{if .Vehicle.SerialNumber}}{{.Vehicle.SerialNumber}}{{else}}N/A{{end}}</span>
              </div>
            </div>
            <div class="row mb-2">
              <div class="col-6">
                <span class="info-label">Base:</span>
                <span class="info-value">{{if .Vehicle.Base}}{{.Vehicle.Base}}{{else}}Not assigned{{end}}</span>
              </div>
              <div class="col-6">
                <span class="info-label">Service Interval:</span>
                <span class="info-value">{{if .Vehicle.ServiceInterval}}{{.Vehicle.ServiceInterval}}{{else}}5000{{end}} miles</span>
              </div>
            </div>
            <div class="row">
              <div class="col-6">
                <span class="info-label">Status:</span>
                <span class="status-badge {{if eq .Vehicle.Status "active"}}status-good{{else if eq .Vehicle.Status "maintenance"}}status-due{{else}}status-overdue{{end}}">
                  {{.Vehicle.Status}}
                </span>
              </div>
              <div class="col-6">
                <span class="info-label">License:</span>
                <span class="info-value">{{if .Vehicle.License}}{{.Vehicle.License}}{{else}}N/A{{end}}</span>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="col-lg-6">
        <div class="enhanced-card service-status-card">
          <div class="card-header">
            <h5 class="mb-0"><i class="bi bi-speedometer2 me-2"></i>Service Status</h5>
          </div>
          <div class="card-body">
            {{if .ServiceRecords}}
            {{$latest := index .ServiceRecords 0}}
            <div class="row">
              <div class="col-4">
                <div class="service-metric">
                  <span class="service-metric-value">{{$latest.LastMileage}}</span>
                  <div class="service-metric-label">Current Miles</div>
                </div>
              </div>
              <div class="col-4">
                <div class="service-metric">
                  <span class="service-metric-value">{{$latest.ServicedMiles}}</span>
                  <div class="service-metric-label">Last Service</div>
                </div>
              </div>
              <div class="col-4">
                <div class="service-metric">
                  <span class="service-metric-value {{if lt $latest.MilesToService 500}}text-danger{{else if lt $latest.MilesToService 1000}}text-warning{{else}}text-success{{end}}">
                    {{$latest.MilesToService}}
                  </span>
                  <div class="service-metric-label">Miles to Service</div>
                </div>
              </div>
            </div>
            {{else}}
            <div class="text-center py-4 text-muted">
              <i class="bi bi-info-circle fs-3 d-block mb-2"></i>
              <p>No service records available</p>
            </div>
            {{end}}
          </div>
        </div>
      </div>
    </div>

    <!-- Maintenance Actions -->
    <div class="row g-4 mb-4">
      <div class="col-md-6">
        <div class="enhanced-card">
          <div class="card-header">
            <h5 class="mb-0"><i class="bi bi-plus-circle me-2"></i>Add Maintenance Record</h5>
          </div>
          <div class="card-body">
            <form method="POST" action="/add-maintenance-record">
              <input type="hidden" name="vehicle_id" value="{{.Vehicle.VehicleID}}">
              <div class="row mb-3">
                <div class="col-md-6">
                  <label class="form-label">Service Date</label>
                  <input type="date" name="service_date" class="form-control" required>
                </div>
                <div class="col-md-6">
                  <label class="form-label">Mileage</label>
                  <input type="number" name="mileage" class="form-control" placeholder="Current mileage" required>
                </div>
              </div>
              <div class="row mb-3">
                <div class="col-md-6">
                  <label class="form-label">PO Number</label>
                  <input type="text" name="po_number" class="form-control" placeholder="Purchase order #">
                </div>
                <div class="col-md-6">
                  <label class="form-label">Cost</label>
                  <input type="number" step="0.01" name="cost" class="form-control" placeholder="0.00">
                </div>
              </div>
              <div class="mb-3">
                <label class="form-label">Work Done</label>
                <textarea name="work_done" class="form-control" rows="3" placeholder="Describe the maintenance work performed..." required></textarea>
              </div>
              <button type="submit" class="btn btn-primary w-100">
                <i class="bi bi-plus-circle me-2"></i>Add Maintenance Record
              </button>
            </form>
          </div>
        </div>
      </div>

      <div class="col-md-6">
        <div class="enhanced-card">
          <div class="card-header">
            <h5 class="mb-0"><i class="bi bi-speedometer me-2"></i>Update Service Record</h5>
          </div>
          <div class="card-body">
            <form method="POST" action="/update-service-record">
              <input type="hidden" name="vehicle_id" value="{{.Vehicle.VehicleID}}">
              <div class="row mb-3">
                <div class="col-md-6">
                  <label class="form-label">Serviced at Miles</label>
                  <input type="number" name="serviced_miles" class="form-control" placeholder="Service mileage" required>
                </div>
                <div class="col-md-6">
                  <label class="form-label">Current Mileage</label>
                  <input type="number" name="last_mileage" class="form-control" placeholder="Current mileage" required>
                </div>
              </div>
              <div class="alert alert-info">
                <i class="bi bi-info-circle me-2"></i>
                Service interval: {{if .Vehicle.ServiceInterval}}{{.Vehicle.ServiceInterval}}{{else}}5000{{end}} miles
              </div>
              <button type="submit" class="btn btn-primary w-100">
                <i class="bi bi-arrow-clockwise me-2"></i>Update Service Status
              </button>
            </form>
          </div>
        </div>
      </div>
    </div>

    <!-- Maintenance History -->
    <div class="row g-4">
      <div class="col-12">
        <div class="enhanced-card maintenance-log-card">
          <div class="card-header">
            <h5 class="mb-0"><i class="bi bi-journal-text me-2"></i>Maintenance History</h5>
          </div>
          <div class="card-body p-0">
            {{if .MaintenanceRecords}}
            <div class="table-responsive table-container">
              <table class="table table-hover mb-0">
                <thead class="table-light sticky-top">
                  <tr>
                    <th>Date</th>
                    <th>Mileage</th>
                    <th>PO#</th>
                    <th>Cost</th>
                    <th>Work Done</th>
                  </tr>
                </thead>
                <tbody>
                  {{range .MaintenanceRecords}}
                  <tr>
                    <td>{{.ServiceDate}}</td>
                    <td>{{if .Mileage}}{{.Mileage}}{{else}}-{{end}}</td>
                    <td>{{if .PONumber}}{{.PONumber}}{{else}}-{{end}}</td>
                    <td>{{if .Cost}}${{printf "%.2f" .Cost}}{{else}}-{{end}}</td>
                    <td>{{.WorkDone}}</td>
                  </tr>
                  {{end}}
                </tbody>
              </table>
            </div>
            {{else}}
            <div class="text-center py-5 text-muted">
              <i class="bi bi-journal-x fs-1 d-block mb-3"></i>
              <h6>No Maintenance Records</h6>
              <p class="mb-0">Add your first maintenance record above</p>
            </div>
            {{end}}
          </div>
        </div>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      // Add animation to cards
      const cards = document.querySelectorAll('.enhanced-card');
      cards.forEach((card, index) => {
        setTimeout(() => {
          card.style.opacity = '0';
          card.style.transform = 'translateY(20px)';
          card.style.transition = 'all 0.5s ease';
          setTimeout(() => {
            card.style.opacity = '1';
            card.style.transform = 'translateY(0)';
          }, 100);
        }, index * 100);
      });
    });
  </script>
</body>
</html>
