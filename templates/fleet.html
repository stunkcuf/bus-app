
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Fleet Management</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">
  <div class="container mt-4">
    <div class="d-flex justify-content-between align-items-center mb-4">
      <h2 class="mb-0">Fleet Management</h2>
      <div>
        <a href="/manager-dashboard" class="btn btn-secondary me-2">Back to Dashboard</a>
        <a href="/logout" class="btn btn-outline-danger">Logout</a>
      </div>
    </div>

    <div class="row">
      <div class="col-md-8">
        <div class="card">
          <div class="card-header">
            <h5>Current Fleet</h5>
          </div>
          <div class="card-body">
            <table class="table table-sm">
              <thead>
                <tr>
                  <th>Bus #</th>
                  <th>Status</th>
                  <th>Model</th>
                  <th>Capacity</th>
                  <th>Oil Status</th>
                  <th>Tire Status</th>
                  <th>Maintenance</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody>
                {{range .Buses}}
                <tr>
                  <td>{{.BusNumber}}</td>
                  <td>
                    <span class="badge {{if eq .Status "active"}}bg-success{{else if eq .Status "maintenance"}}bg-warning{{else}}bg-secondary{{end}}">
                      {{.Status}}
                    </span>
                  </td>
                  <td>{{.Model}}</td>
                  <td>{{.Capacity}}</td>
                  <td>
                    <span class="badge {{if eq .OilStatus "good"}}bg-success{{else if eq .OilStatus "due"}}bg-warning{{else}}bg-danger{{end}}">
                      {{if .OilStatus}}{{.OilStatus}}{{else}}unknown{{end}}
                    </span>
                  </td>
                  <td>
                    <span class="badge {{if eq .TireStatus "good"}}bg-success{{else if eq .TireStatus "worn"}}bg-warning{{else}}bg-danger{{end}}">
                      {{if .TireStatus}}{{.TireStatus}}{{else}}unknown{{end}}
                    </span>
                  </td>
                  <td>{{if .MaintenanceNotes}}{{.MaintenanceNotes}}{{else}}None{{end}}</td>
                  <td>
                    <button class="btn btn-sm btn-outline-primary" data-bs-toggle="modal" data-bs-target="#editBusModal" 
                            onclick="editBus('{{.BusNumber}}', '{{.Status}}', '{{.Model}}', {{.Capacity}}, '{{.OilStatus}}', '{{.TireStatus}}', '{{.MaintenanceNotes}}')">
                      Edit
                    </button>
                    <form method="POST" action="/remove-bus" style="display: inline;" class="ms-1">
                      <input type="hidden" name="bus_id" value="{{.BusNumber}}">
                      <button type="submit" class="btn btn-sm btn-outline-danger" onclick="return confirm('Are you sure you want to remove this bus?')">Remove</button>
                    </form>
                  </td>
                </tr>
                {{end}}
              </tbody>
            </table>
          </div>
        </div>

        <!-- Maintenance Log Form -->
        <div class="card mt-4">
          <div class="card-header">
            <h5>Add Maintenance Log</h5>
          </div>
          <div class="card-body">
            <form method="POST" action="/add-maint">
              <div class="mb-3">
                <label class="form-label">Bus Number</label>
                <select name="bus_id" class="form-select" required>
                  <option value="">Select Bus</option>
                  {{range .Buses}}
                  <option value="{{.BusNumber}}">Bus #{{.BusNumber}} ({{.Model}})</option>
                  {{end}}
                </select>
              </div>
              <div class="mb-3">
                <label class="form-label">Date</label>
                <input type="date" name="date" class="form-control" required>
              </div>
              <div class="mb-3">
                <label class="form-label">Category</label>
                <select name="category" class="form-select" required>
                  <option value="oil">Oil Change</option>
                  <option value="tires">Tire Service</option>
                  <option value="brakes">Brake Service</option>
                  <option value="engine">Engine</option>
                  <option value="transmission">Transmission</option>
                  <option value="electrical">Electrical</option>
                  <option value="other">Other</option>
                </select>
              </div>
              <div class="mb-3">
                <label class="form-label">Mileage (optional)</label>
                <input type="number" name="mileage" class="form-control">
              </div>
              <div class="mb-3">
                <label class="form-label">Notes</label>
                <textarea name="notes" class="form-control" rows="3" required></textarea>
              </div>
              <button type="submit" class="btn btn-warning w-100">Add Maintenance Log</button>
            </form>
          </div>
        </div>
      </div>

      <div class="col-md-4">
        <div class="card">
          <div class="card-header">
            <h5>Add New Bus</h5>
          </div></div>
        </div>
      </div>

      <div class="col-md-4">
        <div class="card">
          <div class="card-header">
            <h5>Add New Bus</h5>
          </div>
          <div class="card-body">
            <form method="POST" action="/add-bus">
              <div class="mb-3">
                <label class="form-label">Bus Number</label>
                <input type="text" name="bus_id" class="form-control" required>
              </div>
              <div class="mb-3">
                <label class="form-label">Status</label>
                <select name="status" class="form-select" required>
                  <option value="active">Active</option>
                  <option value="maintenance">Maintenance</option>
                  <option value="out_of_service">Out of Service</option>
                </select>
              </div>
              <div class="mb-3">
                <label class="form-label">Model</label>
                <input type="text" name="model" class="form-control">
              </div>
              <div class="mb-3">
                <label class="form-label">Capacity</label>
                <input type="number" name="capacity" class="form-control">
              </div>
              <div class="mb-3">
                <label class="form-label">Oil Status</label>
                <select name="oil_status" class="form-select">
                  <option value="good">Good</option>
                  <option value="due">Due for Change</option>
                  <option value="overdue">Overdue</option>
                </select>
              </div>
              <div class="mb-3">
                <label class="form-label">Tire Status</label>
                <select name="tire_status" class="form-select">
                  <option value="good">Good</option>
                  <option value="worn">Worn</option>
                  <option value="replace">Need Replacement</option>
                </select>
              </div>
              <div class="mb-3">
                <label class="form-label">Maintenance Notes</label>
                <textarea name="maintenance_notes" class="form-control" rows="3"></textarea>
              </div>
              <button type="submit" class="btn btn-primary w-100">Add Bus</button>
            </form>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Edit Bus Modal -->
  <div class="modal fade" id="editBusModal" tabindex="-1">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Edit Bus</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <form method="POST" action="/edit-bus">
          <div class="modal-body">
            <input type="hidden" name="original_bus_id" id="editOriginalBusId">
            <div class="mb-3">
              <label class="form-label">Bus Number</label>
              <input type="text" name="bus_id" id="editBusId" class="form-control" required>
            </div>
            <div class="mb-3">
              <label class="form-label">Status</label>
              <select name="status" id="editStatus" class="form-select" required>
                <option value="active">Active</option>
                <option value="maintenance">Maintenance</option>
                <option value="out_of_service">Out of Service</option>
              </select>
            </div>
            <div class="mb-3">
              <label class="form-label">Model</label>
              <input type="text" name="model" id="editModel" class="form-control">
            </div>
            <div class="mb-3">
              <label class="form-label">Capacity</label>
              <input type="number" name="capacity" id="editCapacity" class="form-control">
            </div>
            <div class="mb-3">
              <label class="form-label">Oil Status</label>
              <select name="oil_status" id="editOilStatus" class="form-select">
                <option value="good">Good</option>
                <option value="due">Due for Change</option>
                <option value="overdue">Overdue</option>
              </select>
            </div>
            <div class="mb-3">
              <label class="form-label">Tire Status</label>
              <select name="tire_status" id="editTireStatus" class="form-select">
                <option value="good">Good</option>
                <option value="worn">Worn</option>
                <option value="replace">Need Replacement</option>
              </select>
            </div>
            <div class="mb-3">
              <label class="form-label">Maintenance Notes</label>
              <textarea name="maintenance_notes" id="editMaintenanceNotes" class="form-control" rows="3"></textarea>
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
            <button type="submit" class="btn btn-primary">Save Changes</button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    function editBus(busNumber, status, model, capacity, oilStatus, tireStatus, maintenanceNotes) {
      document.getElementById('editOriginalBusId').value = busNumber;
      document.getElementById('editBusId').value = busNumber;
      document.getElementById('editStatus').value = status;
      document.getElementById('editModel').value = model;
      document.getElementById('editCapacity').value = capacity;
      document.getElementById('editOilStatus').value = oilStatus || 'good';
      document.getElementById('editTireStatus').value = tireStatus || 'good';
      document.getElementById('editMaintenanceNotes').value = maintenanceNotes;
    }
  </script>
</body>
</html>
