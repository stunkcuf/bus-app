<!DOCTYPE html>
<html>
<head>
    <title>Simple GPS Monitor</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        #status { padding: 10px; margin: 10px 0; border-radius: 5px; }
        .connected { background: #d4edda; color: #155724; }
        .disconnected { background: #f8d7da; color: #721c24; }
        .update { 
            padding: 10px; 
            margin: 5px 0; 
            background: #f0f0f0; 
            border-left: 4px solid #28a745;
            font-family: monospace;
        }
    </style>
</head>
<body>
    <h1>Simple GPS Monitor</h1>
    <div id="status" class="disconnected">Not Connected</div>
    <button onclick="connect()">Connect to GPS Stream</button>
    <button onclick="clearLog()">Clear Log</button>
    <div id="log"></div>
    
    <script>
        let eventSource = null;
        const log = document.getElementById('log');
        const status = document.getElementById('status');
        
        function addLog(message) {
            const div = document.createElement('div');
            div.className = 'update';
            div.textContent = new Date().toLocaleTimeString() + ' - ' + message;
            log.insertBefore(div, log.firstChild);
            if (log.children.length > 20) {
                log.removeChild(log.lastChild);
            }
        }
        
        function connect() {
            if (eventSource) {
                eventSource.close();
            }
            
            addLog('Attempting to connect...');
            eventSource = new EventSource('/api/gps/stream');
            
            eventSource.onopen = function(e) {
                status.className = 'connected';
                status.textContent = 'Connected to GPS Stream';
                addLog('Connection opened');
            };
            
            eventSource.onmessage = function(e) {
                addLog('Message: ' + e.data);
            };
            
            eventSource.addEventListener('connected', function(e) {
                addLog('Connected event: ' + e.data);
            });
            
            eventSource.addEventListener('gps_update', function(e) {
                addLog('GPS Update: ' + e.data);
                try {
                    const data = JSON.parse(e.data);
                    addLog(`Bus ${data.vehicle_id} at ${data.latitude.toFixed(4)}, ${data.longitude.toFixed(4)}`);
                } catch (err) {
                    addLog('Parse error: ' + err.message);
                }
            });
            
            eventSource.addEventListener('heartbeat', function(e) {
                addLog('Heartbeat: ' + e.data);
            });
            
            eventSource.onerror = function(e) {
                status.className = 'disconnected';
                status.textContent = 'Disconnected';
                addLog('Connection error - will retry');
            };
        }
        
        function clearLog() {
            log.innerHTML = '';
        }
        
        // Auto-connect on load
        window.addEventListener('load', connect);
    </script>
</body>
</html>